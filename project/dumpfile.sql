-- --------------------------------------------------------
-- 호스트:                          127.0.0.1
-- 서버 버전:                        11.1.3-MariaDB - mariadb.org binary distribution
-- 서버 OS:                        Win64
-- HeidiSQL 버전:                  12.3.0.6589
-- --------------------------------------------------------

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;


-- borad 데이터베이스 구조 내보내기
CREATE DATABASE IF NOT EXISTS `borad` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci */;
USE `borad`;

-- 테이블 borad.author 구조 내보내기
CREATE TABLE IF NOT EXISTS `author` (
  `id` int(11) NOT NULL,
  `name` varchar(100) NOT NULL,
  `email` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `role` enum('user','admin') NOT NULL DEFAULT 'user',
  `address` varchar(255) DEFAULT NULL,
  `age` tinyint(3) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `email_Unique` (`email`,`name`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 테이블 데이터 borad.author:~10 rows (대략적) 내보내기
INSERT IGNORE INTO `author` (`id`, `name`, `email`, `password`, `role`, `address`, `age`) VALUES
	(1, '1', NULL, NULL, 'user', NULL, 22),
	(2, 'qweq', NULL, NULL, 'user', NULL, 23),
	(3, 'ytqqe', NULL, NULL, 'user', NULL, 24),
	(10, 'dd', 'asd@asd', NULL, 'user', NULL, 25),
	(12, 'HFDG', 'asd11@asd', NULL, 'user', NULL, 26),
	(13, 'HWER', 'asd22@asd', NULL, 'user', NULL, 27),
	(15, 'QWE', 'asd33@asd', NULL, 'user', NULL, 28),
	(16, 'TYYERT', 'asd44@asd', NULL, 'user', NULL, 29),
	(17, 'XCBDF', 'asd55@asd', NULL, 'user', NULL, 30),
	(18, 'ZZS', 'asd66@asd', NULL, 'user', NULL, 21);

-- 뷰 borad.author_for_view 구조 내보내기
-- VIEW 종속성 오류를 극복하기 위해 임시 테이블을 생성합니다.
CREATE TABLE `author_for_view` (
	`NAME` VARCHAR(100) NOT NULL COLLATE 'utf8mb4_general_ci',
	`email` VARCHAR(255) NULL COLLATE 'utf8mb4_general_ci'
) ENGINE=MyISAM;

-- 프로시저 borad.getUser 구조 내보내기
DELIMITER //
CREATE PROCEDURE `getUser`(
	IN `userID` int
)
BEGIN
	SELECT * FROM author WHERE id =userID;
END//
DELIMITER ;

-- 프로시저 borad.isHighAuthor 구조 내보내기
DELIMITER //
CREATE PROCEDURE `isHighAuthor`(
	IN `a_id` INT
)
BEGIN

	DECLARE testPrice INT;

	SELECT price INTO testPrice
	FROM post
	WHERE author_id = a_id;

	IF testPrice > 1000 THEN
		SELECT "고액 원고료 작가입니다 ";
	ELSE
		SELECT "고액 원고료 작가가 아닙니다 ";
	END IF;
	
END//
DELIMITER ;

-- 테이블 borad.post 구조 내보내기
CREATE TABLE IF NOT EXISTS `post` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) NOT NULL,
  `contents` varchar(3000) DEFAULT NULL,
  `author_id` int(11) DEFAULT NULL,
  `price` decimal(10,3) NOT NULL DEFAULT 2000.000,
  `created_time` datetime(6) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `post_author_fk` (`author_id`),
  CONSTRAINT `post_author_fk` FOREIGN KEY (`author_id`) REFERENCES `author` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=109 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 테이블 데이터 borad.post:~107 rows (대략적) 내보내기
INSERT IGNORE INTO `post` (`id`, `title`, `contents`, `author_id`, `price`, `created_time`) VALUES
	(1, '11', '11', 1, 0.000, '2022-11-17 16:28:16.000000'),
	(2, '22', '22', 17, 0.000, '2023-11-17 16:28:19.000000'),
	(3, '33', '33', 15, 0.000, '2023-11-17 16:28:22.000000'),
	(4, '44', '44', 13, 0.000, '2023-11-17 16:28:24.000000'),
	(5, '55', '55', 10, 0.000, '2023-11-17 16:28:25.000000'),
	(6, '66', '55', 3, 0.000, '2022-11-17 16:28:27.000000'),
	(8, 'qwe', '123', 18, 123123.000, NULL),
	(9, 'HELLOWORLD0', NULL, NULL, 2000.000, NULL),
	(10, 'HELLOWORLD1', NULL, NULL, 2000.000, NULL),
	(11, 'HELLOWORLD2', NULL, NULL, 2000.000, NULL),
	(12, 'HELLOWORLD3', NULL, NULL, 2000.000, NULL),
	(13, 'HELLOWORLD4', NULL, NULL, 2000.000, NULL),
	(14, 'HELLOWORLD5', NULL, NULL, 2000.000, NULL),
	(15, 'HELLOWORLD6', NULL, NULL, 2000.000, NULL),
	(16, 'HELLOWORLD7', NULL, NULL, 2000.000, NULL),
	(17, 'HELLOWORLD8', NULL, NULL, 2000.000, NULL),
	(18, 'HELLOWORLD9', NULL, NULL, 2000.000, NULL),
	(19, 'HELLOWORLD10', NULL, NULL, 2000.000, NULL),
	(20, 'HELLOWORLD11', NULL, NULL, 2000.000, NULL),
	(21, 'HELLOWORLD12', NULL, NULL, 2000.000, NULL),
	(22, 'HELLOWORLD13', NULL, NULL, 2000.000, NULL),
	(23, 'HELLOWORLD14', NULL, NULL, 2000.000, NULL),
	(24, 'HELLOWORLD15', NULL, NULL, 2000.000, NULL),
	(25, 'HELLOWORLD16', NULL, NULL, 2000.000, NULL),
	(26, 'HELLOWORLD17', NULL, NULL, 2000.000, NULL),
	(27, 'HELLOWORLD18', NULL, NULL, 2000.000, NULL),
	(28, 'HELLOWORLD19', NULL, NULL, 2000.000, NULL),
	(29, 'HELLOWORLD20', NULL, NULL, 2000.000, NULL),
	(30, 'HELLOWORLD21', NULL, NULL, 2000.000, NULL),
	(31, 'HELLOWORLD22', NULL, NULL, 2000.000, NULL),
	(32, 'HELLOWORLD23', NULL, NULL, 2000.000, NULL),
	(33, 'HELLOWORLD24', NULL, NULL, 2000.000, NULL),
	(34, 'HELLOWORLD25', NULL, NULL, 2000.000, NULL),
	(35, 'HELLOWORLD26', NULL, NULL, 2000.000, NULL),
	(36, 'HELLOWORLD27', NULL, NULL, 2000.000, NULL),
	(37, 'HELLOWORLD28', NULL, NULL, 2000.000, NULL),
	(38, 'HELLOWORLD29', NULL, NULL, 2000.000, NULL),
	(39, 'HELLOWORLD30', NULL, NULL, 2000.000, NULL),
	(40, 'HELLOWORLD31', NULL, NULL, 2000.000, NULL),
	(41, 'HELLOWORLD32', NULL, NULL, 2000.000, NULL),
	(42, 'HELLOWORLD33', NULL, NULL, 2000.000, NULL),
	(43, 'HELLOWORLD34', NULL, NULL, 2000.000, NULL),
	(44, 'HELLOWORLD35', NULL, NULL, 2000.000, NULL),
	(45, 'HELLOWORLD36', NULL, NULL, 2000.000, NULL),
	(46, 'HELLOWORLD37', NULL, NULL, 2000.000, NULL),
	(47, 'HELLOWORLD38', NULL, NULL, 2000.000, NULL),
	(48, 'HELLOWORLD39', NULL, NULL, 2000.000, NULL),
	(49, 'HELLOWORLD40', NULL, NULL, 2000.000, NULL),
	(50, 'HELLOWORLD41', NULL, NULL, 2000.000, NULL),
	(51, 'HELLOWORLD42', NULL, NULL, 2000.000, NULL),
	(52, 'HELLOWORLD43', NULL, NULL, 2000.000, NULL),
	(53, 'HELLOWORLD44', NULL, NULL, 2000.000, NULL),
	(54, 'HELLOWORLD45', NULL, NULL, 2000.000, NULL),
	(55, 'HELLOWORLD46', NULL, NULL, 2000.000, NULL),
	(56, 'HELLOWORLD47', NULL, NULL, 2000.000, NULL),
	(57, 'HELLOWORLD48', NULL, NULL, 2000.000, NULL),
	(58, 'HELLOWORLD49', NULL, NULL, 2000.000, NULL),
	(59, 'HELLOWORLD50', NULL, NULL, 2000.000, NULL),
	(60, 'HELLOWORLD51', NULL, NULL, 2000.000, NULL),
	(61, 'HELLOWORLD52', NULL, NULL, 2000.000, NULL),
	(62, 'HELLOWORLD53', NULL, NULL, 2000.000, NULL),
	(63, 'HELLOWORLD54', NULL, NULL, 2000.000, NULL),
	(64, 'HELLOWORLD55', NULL, NULL, 2000.000, NULL),
	(65, 'HELLOWORLD56', NULL, NULL, 2000.000, NULL),
	(66, 'HELLOWORLD57', NULL, NULL, 2000.000, NULL),
	(67, 'HELLOWORLD58', NULL, NULL, 2000.000, NULL),
	(68, 'HELLOWORLD59', NULL, NULL, 2000.000, NULL),
	(69, 'HELLOWORLD60', NULL, NULL, 2000.000, NULL),
	(70, 'HELLOWORLD61', NULL, NULL, 2000.000, NULL),
	(71, 'HELLOWORLD62', NULL, NULL, 2000.000, NULL),
	(72, 'HELLOWORLD63', NULL, NULL, 2000.000, NULL),
	(73, 'HELLOWORLD64', NULL, NULL, 2000.000, NULL),
	(74, 'HELLOWORLD65', NULL, NULL, 2000.000, NULL),
	(75, 'HELLOWORLD66', NULL, NULL, 2000.000, NULL),
	(76, 'HELLOWORLD67', NULL, NULL, 2000.000, NULL),
	(77, 'HELLOWORLD68', NULL, NULL, 2000.000, NULL),
	(78, 'HELLOWORLD69', NULL, NULL, 2000.000, NULL),
	(79, 'HELLOWORLD70', NULL, NULL, 2000.000, NULL),
	(80, 'HELLOWORLD71', NULL, NULL, 2000.000, NULL),
	(81, 'HELLOWORLD72', NULL, NULL, 2000.000, NULL),
	(82, 'HELLOWORLD73', NULL, NULL, 2000.000, NULL),
	(83, 'HELLOWORLD74', NULL, NULL, 2000.000, NULL),
	(84, 'HELLOWORLD75', NULL, NULL, 2000.000, NULL),
	(85, 'HELLOWORLD76', NULL, NULL, 2000.000, NULL),
	(86, 'HELLOWORLD77', NULL, NULL, 2000.000, NULL),
	(87, 'HELLOWORLD78', NULL, NULL, 2000.000, NULL),
	(88, 'HELLOWORLD79', NULL, NULL, 2000.000, NULL),
	(89, 'HELLOWORLD80', NULL, NULL, 2000.000, NULL),
	(90, 'HELLOWORLD81', NULL, NULL, 2000.000, NULL),
	(91, 'HELLOWORLD82', NULL, NULL, 2000.000, NULL),
	(92, 'HELLOWORLD83', NULL, NULL, 2000.000, NULL),
	(93, 'HELLOWORLD84', NULL, NULL, 2000.000, NULL),
	(94, 'HELLOWORLD85', NULL, NULL, 2000.000, NULL),
	(95, 'HELLOWORLD86', NULL, NULL, 2000.000, NULL),
	(96, 'HELLOWORLD87', NULL, NULL, 2000.000, NULL),
	(97, 'HELLOWORLD88', NULL, NULL, 2000.000, NULL),
	(98, 'HELLOWORLD89', NULL, NULL, 2000.000, NULL),
	(99, 'HELLOWORLD90', NULL, NULL, 2000.000, NULL),
	(100, 'HELLOWORLD91', NULL, NULL, 2000.000, NULL),
	(101, 'HELLOWORLD92', NULL, NULL, 2000.000, NULL),
	(102, 'HELLOWORLD93', NULL, NULL, 2000.000, NULL),
	(103, 'HELLOWORLD94', NULL, NULL, 2000.000, NULL),
	(104, 'HELLOWORLD95', NULL, NULL, 2000.000, NULL),
	(105, 'HELLOWORLD96', NULL, NULL, 2000.000, NULL),
	(106, 'HELLOWORLD97', NULL, NULL, 2000.000, NULL),
	(107, 'HELLOWORLD98', NULL, NULL, 2000.000, NULL),
	(108, 'HELLOWORLD99', NULL, NULL, 2000.000, NULL);

-- 프로시저 borad.setPostDATA 구조 내보내기
DELIMITER //
CREATE PROCEDURE `setPostDATA`()
BEGIN
	DECLARE numIndex INT default 0;
	WHILE numIndex < 100 DO
		INSERT INTO post(title) VALUES(CONCAT('HELLOWORLD', numIndex));
		SET numIndex = numIndex + 1;
	END WHILE;
END//
DELIMITER ;

-- 프로시저 borad.setPostProc 구조 내보내기
DELIMITER //
CREATE PROCEDURE `setPostProc`(
	IN tit VARCHAR(255),
	IN cont VARCHAR(3000),
	IN a_id INT
)
BEGIN 
	INSERT INTO post(title, contents, author_id) VALUES(tit, cont, a_id);
END//
DELIMITER ;

-- 뷰 borad.author_for_view 구조 내보내기
-- 임시 테이블을 제거하고 최종 VIEW 구조를 생성
DROP TABLE IF EXISTS `author_for_view`;
CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `author_for_view` AS SELECT NAME, email
FROM author ;

/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, 'system') */;
/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */;
